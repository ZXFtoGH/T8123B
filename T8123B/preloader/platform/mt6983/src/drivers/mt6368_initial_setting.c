#include <mt6368_pmic.h>
#include <pal_log.h>

/*
 * CONFIG OPTION SET
 */
/* Enable this option when pmic initial setting is verified */
#define INIT_SETTING_VERIFIED	1
#define EFUSE_SW_LOAD		1

struct pmic_setting {
	unsigned short addr;
	unsigned short val;
	unsigned short mask;
	unsigned char shift;
};

static struct pmic_setting init_setting[] = {
	{0x16, 0xA, 0xA, 0},
	{0x19, 0x1F, 0x1F, 0},
	{0x21, 0x1, 0x1, 0},
	{0x4B, 0x0, 0xFF, 0},
	{0x4E, 0x0, 0x80, 0},
	{0x57, 0x1, 0x1, 0},
	{0x59, 0x4, 0x4, 0},
	{0x91, 0x50, 0xFF, 0},
	{0x94, 0xFE, 0xFF, 0},
	{0x97, 0x0, 0xFF, 0},
	{0x10F, 0x10, 0x10, 0},
	{0x112, 0x4, 0x4, 0},
	{0x12D, 0x1, 0x1, 0},
	{0x139, 0x21, 0x21, 0},
	{0x230, 0x0, 0x1, 0},
	{0x413, 0x7, 0xFF, 0},
	{0x416, 0x12, 0xFF, 0},
	{0x417, 0x0, 0x7, 0},
	{0x447, 0x10, 0xFF, 0},
	{0x448, 0x0, 0x7, 0},
	{0xA16, 0xFF, 0xFF, 0},
	{0xA17, 0xF8, 0xF8, 0},
	{0xA1B, 0xD, 0xFF, 0},
	{0xF8C, 0x15, 0x15, 0},
	{0xF8D, 0x25, 0x25, 0},
	{0x1188, 0x0, 0x80, 0},
	{0x1190, 0x13, 0xFF, 0},
	{0x119B, 0x20, 0xFF, 0},
	{0x119D, 0x60, 0x70, 0},
	{0x11A0, 0x60, 0x70, 0},
	{0x11C6, 0xF, 0xF, 0},
	{0x11C7, 0x0, 0xF, 0},
	{0x140E, 0x0, 0x40, 0},
	{0x1437, 0x0, 0xFF, 0},
	{0x1438, 0x0, 0xF, 0},
	{0x1587, 0x58, 0xFF, 0},
	{0x158A, 0xC, 0x7F, 0},
	{0x1809, 0x12, 0x56, 0},
	{0x180A, 0x2D, 0x2F, 0},
	{0x180B, 0x1, 0x1, 0},
	{0x180C, 0xFA, 0xFF, 0},
	{0x180D, 0x32, 0x3F, 0},
	{0x180F, 0xC, 0xC, 0},
	{0x1811, 0x80, 0xFF, 0},
	{0x1812, 0xE, 0xF, 0},
	{0x1813, 0x12, 0x56, 0},
	{0x1814, 0x2D, 0x2F, 0},
	{0x1815, 0x1, 0x1, 0},
	{0x1816, 0xFA, 0xFF, 0},
	{0x1817, 0x32, 0x3F, 0},
	{0x1819, 0xC, 0xC, 0},
	{0x181B, 0x80, 0xFF, 0},
	{0x181C, 0xE, 0xF, 0},
	{0x181D, 0x10, 0x50, 0},
	{0x181E, 0x2D, 0x2F, 0},
	{0x1820, 0xF8, 0xF8, 0},
	{0x1821, 0x32, 0x3F, 0},
	{0x1823, 0xC, 0xC, 0},
	{0x1824, 0xEF, 0xFF, 0},
	{0x1825, 0x10, 0xFF, 0},
	{0x1827, 0x10, 0x50, 0},
	{0x1828, 0x2D, 0x2F, 0},
	{0x182A, 0xF8, 0xF8, 0},
	{0x182B, 0x32, 0x3F, 0},
	{0x182D, 0xC, 0xC, 0},
	{0x182E, 0xEF, 0xFF, 0},
	{0x182F, 0x10, 0xFF, 0},
	{0x1838, 0xF0, 0xF0, 0},
	{0x183A, 0x1F, 0xFF, 0},
	{0x183B, 0x1F, 0xFF, 0},
	{0x183C, 0xE5, 0xFF, 0},
	{0x183D, 0xE5, 0xFF, 0},
	{0x183E, 0xF0, 0xF0, 0},
	{0x183F, 0xC0, 0xC0, 0},
	{0x184A, 0x0, 0x40, 0},
	{0x184E, 0x0, 0x80, 0},
	{0x1852, 0x0, 0x40, 0},
	{0x1856, 0x0, 0x80, 0},
	{0x185A, 0x0, 0x40, 0},
	{0x185E, 0x0, 0x80, 0},
	{0x1862, 0x0, 0x40, 0},
	{0x1866, 0x80, 0x80, 0},
	{0x1888, 0x10, 0x50, 0},
	{0x1889, 0x2D, 0x2F, 0},
	{0x188B, 0xF8, 0xF8, 0},
	{0x188C, 0x32, 0x3F, 0},
	{0x188E, 0xC, 0xC, 0},
	{0x188F, 0xEF, 0xFF, 0},
	{0x1890, 0x10, 0xFF, 0},
	{0x1894, 0x40, 0x40, 0},
	{0x1895, 0xE5, 0xFF, 0},
	{0x1896, 0xA, 0xA, 0},
	{0x1897, 0x10, 0x50, 0},
	{0x1898, 0x2D, 0x2F, 0},
	{0x189A, 0xF8, 0xF8, 0},
	{0x189B, 0x32, 0x3F, 0},
	{0x189D, 0xC, 0xC, 0},
	{0x189E, 0xEF, 0xFF, 0},
	{0x189F, 0x10, 0xFF, 0},
	{0x18A3, 0x40, 0x40, 0},
	{0x18A4, 0xE5, 0xFF, 0},
	{0x18A5, 0xA, 0xA, 0},
	{0x18A6, 0x40, 0xC0, 0},
	{0x18A7, 0x6, 0xF, 0},
	{0x18A8, 0x3C, 0x3C, 0},
	{0x18A9, 0x1, 0x3, 0},
	{0x18AB, 0x1C, 0xFF, 0},
	{0x18AC, 0x88, 0xFF, 0},
	{0x18AF, 0x40, 0xFF, 0},
	{0x18B1, 0x0, 0x80, 0},
	{0x18B6, 0x40, 0x40, 0},
	{0x18BA, 0x0, 0x80, 0},
	{0x18BE, 0x0, 0x40, 0},
	{0x18C2, 0x80, 0x80, 0},
	{0x1B0D, 0xF, 0xF, 0},
	{0x1B0E, 0x1, 0x1, 0},
	{0x1B12, 0xFF, 0xFF, 0},
	{0x1B15, 0xFF, 0xFF, 0},
	{0x1B18, 0xFF, 0xFF, 0},
	{0x1B2C, 0x8, 0x8, 0},
	{0x1B89, 0x0, 0x80, 0},
	{0x1B98, 0x0, 0x80, 0},
	{0x1BA7, 0x0, 0x80, 0},
	{0x1BB5, 0x0, 0x80, 0},
	{0x1BC3, 0x0, 0x80, 0},
	{0x1BD1, 0x0, 0x80, 0},
	{0x1BD6, 0x40, 0x40, 0},
	{0x1C09, 0x0, 0x80, 0},
	{0x1C17, 0x0, 0x80, 0},
	{0x1C25, 0x0, 0x80, 0},
	{0x1C33, 0x0, 0x80, 0},
	{0x1C41, 0x0, 0x80, 0},
	{0x1C4F, 0x0, 0x80, 0},
	{0x1C89, 0x0, 0x80, 0},
	{0x1C97, 0x0, 0x80, 0},
	{0x1CA6, 0x0, 0x80, 0},
	{0x1CB4, 0x0, 0x80, 0},
	{0x1CC2, 0x0, 0x80, 0},
	{0x1CD0, 0x0, 0x80, 0},
	{0x1D09, 0x0, 0x80, 0},
};

static void second_pmic_cmp_register(void)
{
#if INIT_SETTING_VERIFIED
	int i;
	U8 val = 0;

	for (i = 0; i < ARRAY_SIZE(init_setting); i++) {
		second_pmic_read_interface(init_setting[i].addr, &val,
					   init_setting[i].mask,
					   init_setting[i].shift);
		if (val != init_setting[i].val) {
			pal_log_info("second_pmic_init cmp: 0x%x\tval=0x%x\trval=0x%x\t0x%x\t%d\n"
				     , init_setting[i].addr, init_setting[i].val, val
				     , init_setting[i].mask, init_setting[i].shift);
		}
	}
#endif
}

void second_pmic_init_setting(void)
{
	unsigned int ret = 0;
	int i;

	pal_log_info("%s start\n", __func__);
#if INIT_SETTING_VERIFIED
	/* TOP_TMA_KEY */
	second_upmu_set_reg_value16(MT6368_PMIC_TMA_KEY_L_ADDR, 0x9C97);
	/* HK_TOP_WKEY */
	second_upmu_set_reg_value16(MT6368_PMIC_HK_AUXADC_KEY_L_ADDR, 0x6368);
	/* BUCK_TOP_KEY_PROT */
	second_upmu_set_reg_value16(MT6368_PMIC_BUCK_TOP_WRITE_KEY_LO_ADDR, 0x5543);
	/* PLT_KEY */
	second_upmu_set_reg_value16(MT6368_PMIC_PLT_WPK_KEY_ADDR, 0x9C97);
	/* CPS_WKEY */
	second_upmu_set_reg_value16(MT6368_PMIC_RG_CPS_W_KEY_ADDR, 0x4729);

	/* For VIO18 switch to DIG18 feature */
	second_pmic_config_interface(MT6368_PMIC_RG_VDIG18_VREF_SEL_ADDR, 0x1,
				     MT6368_PMIC_RG_VDIG18_VREF_SEL_MASK,
				     MT6368_PMIC_RG_VDIG18_VREF_SEL_SHIFT);

	for (i = 0; i < ARRAY_SIZE(init_setting); i++) {
		ret = second_pmic_config_interface(init_setting[i].addr, init_setting[i].val,
						   init_setting[i].mask, init_setting[i].shift);
	}
#if EFUSE_SW_LOAD
	second_pmic_efuse_sw_load();
#else
	pal_log_info("[SECOND_PMIC] No EFUSE SW Load\n");
#endif

	/* TOP_TMA_KEY */
	second_upmu_set_reg_value16(MT6368_PMIC_TMA_KEY_L_ADDR, 0x0);
	/* HK_TOP_WKEY */
	second_upmu_set_reg_value16(MT6368_PMIC_HK_AUXADC_KEY_L_ADDR, 0x0);
	/* BUCK_TOP_KEY_PROT */
	second_upmu_set_reg_value16(MT6368_PMIC_BUCK_TOP_WRITE_KEY_LO_ADDR, 0x0);
	/* PLT_KEY */
	second_upmu_set_reg_value16(MT6368_PMIC_PLT_WPK_KEY_ADDR, 0x0);
	/* CPS_WKEY */
	second_upmu_set_reg_value16(MT6368_PMIC_RG_CPS_W_KEY_ADDR, 0x0);

	pal_log_info("[SECOND_PMIC] mt6368_init_setting end. v210501\n");
#endif
}

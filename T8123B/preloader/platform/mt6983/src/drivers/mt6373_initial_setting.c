#include <mt6373_pmic.h>
#include <pal_log.h>

/*
 * CONFIG OPTION SET
 */
/* Enable this option when pmic initial setting is verified */
#define INIT_SETTING_VERIFIED	1
#define EFUSE_SW_LOAD		0

struct pmic_setting {
	unsigned short addr;
	unsigned short val;
	unsigned short mask;
	unsigned char shift;
};

static struct pmic_setting init_setting[] = {
	{0x16, 0xA, 0xA, 0},
	{0x19, 0x1F, 0x1F, 0},
	{0x21, 0x1, 0x1, 0},
	{0x4C, 0x0, 0xFF, 0},
	{0x4F, 0x0, 0x80, 0},
	{0x5A, 0x5, 0x5, 0},
	{0x91, 0x93, 0xFF, 0},
	{0x94, 0xFF, 0xFF, 0},
	{0x97, 0xF, 0xFF, 0},
	{0xC4, 0x0, 0x38, 0},
	{0xC7, 0x0, 0x3F, 0},
	{0xCA, 0x0, 0x3F, 0},
	{0xCD, 0x0, 0x3F, 0},
	{0xD0, 0x0, 0x3F, 0},
	{0xD3, 0x0, 0x3F, 0},
	{0xD6, 0x0, 0x3F, 0},
	{0x10F, 0x10, 0x10, 0},
	{0x112, 0x4, 0x4, 0},
	{0x12D, 0x1, 0x1, 0},
	{0x139, 0x21, 0x21, 0},
	{0x230, 0x0, 0x1, 0},
	{0x3A6, 0x3, 0x3, 0},
	{0x413, 0x7, 0xFF, 0},
	{0x416, 0x12, 0xFF, 0},
	{0x417, 0x0, 0x7, 0},
	{0x90D, 0x10, 0x10, 0},
	{0xA17, 0xFF, 0xFF, 0},
	{0xA18, 0xFF, 0xFF, 0},
	{0xA19, 0xFC, 0xFC, 0},
	{0xF8C, 0x15, 0x15, 0},
	{0xF8D, 0x25, 0x25, 0},
	{0x1188, 0x0, 0x80, 0},
	{0x1190, 0x13, 0xFF, 0},
	{0x119B, 0x20, 0xFF, 0},
	{0x119D, 0x60, 0x70, 0},
	{0x11A0, 0x60, 0x70, 0},
	{0x11C6, 0xF, 0xF, 0},
	{0x11C7, 0x0, 0xF, 0},
	{0x140E, 0x0, 0x40, 0},
	{0x144A, 0x0, 0xFF, 0},
	{0x144B, 0x2, 0xFF, 0},
	{0x144C, 0x0, 0xF, 0},
	{0x1487, 0x92, 0xFF, 0},
	{0x1488, 0x0, 0x1, 0},
	{0x1508, 0x0, 0x1, 0},
	{0x1588, 0x0, 0x1, 0},
	{0x1608, 0x0, 0x1, 0},
	{0x1688, 0x0, 0x1, 0},
	{0x1708, 0x0, 0x1, 0},
	{0x1788, 0x0, 0x1, 0},
	{0x1808, 0x0, 0x1, 0},
	{0x1888, 0x0, 0x1, 0},
	{0x1908, 0x0, 0x1, 0},
	{0x1989, 0x10, 0x56, 0},
	{0x198A, 0x2D, 0x2F, 0},
	{0x198B, 0x2, 0x2, 0},
	{0x198C, 0xFA, 0xFF, 0},
	{0x198D, 0x32, 0x3F, 0},
	{0x198F, 0xC, 0xC, 0},
	{0x1990, 0x7F, 0xFF, 0},
	{0x1991, 0xC0, 0xFF, 0},
	{0x1992, 0x6B, 0x7F, 0},
	{0x1993, 0x10, 0x56, 0},
	{0x1994, 0x2D, 0x2F, 0},
	{0x1995, 0x61, 0x61, 0},
	{0x1996, 0xFA, 0xFF, 0},
	{0x1997, 0x32, 0x3F, 0},
	{0x1999, 0xC, 0xC, 0},
	{0x199A, 0x7F, 0xFF, 0},
	{0x199B, 0xC0, 0xFF, 0},
	{0x199C, 0x6B, 0x7F, 0},
	{0x19A0, 0xF, 0xF, 0},
	{0x19A1, 0x5F, 0xFF, 0},
	{0x19A2, 0x5F, 0xFF, 0},
	{0x19A3, 0xC, 0xC, 0},
	{0x19B5, 0x7, 0x87, 0},
	{0x19BD, 0x7, 0x87, 0},
	{0x19C0, 0x0, 0x18, 0},
	{0x1A08, 0x10, 0x50, 0},
	{0x1A09, 0xD, 0x2F, 0},
	{0x1A0B, 0xF8, 0xF8, 0},
	{0x1A0C, 0x32, 0x3F, 0},
	{0x1A0E, 0xC, 0xC, 0},
	{0x1A0F, 0xEF, 0xFF, 0},
	{0x1A10, 0x10, 0xFF, 0},
	{0x1A12, 0x10, 0x56, 0},
	{0x1A13, 0x2D, 0x2F, 0},
	{0x1A14, 0x1, 0x1, 0},
	{0x1A15, 0xFA, 0xFF, 0},
	{0x1A16, 0x32, 0x3F, 0},
	{0x1A18, 0xC, 0xC, 0},
	{0x1A19, 0x7F, 0xFF, 0},
	{0x1A1A, 0xC0, 0xFF, 0},
	{0x1A1B, 0x6B, 0x7F, 0},
	{0x1A1C, 0x10, 0x56, 0},
	{0x1A1D, 0x2D, 0x2F, 0},
	{0x1A1E, 0xC1, 0xC1, 0},
	{0x1A1F, 0xFA, 0xFF, 0},
	{0x1A20, 0x32, 0x3F, 0},
	{0x1A22, 0xC, 0xC, 0},
	{0x1A23, 0x7F, 0xFF, 0},
	{0x1A24, 0xC0, 0xFF, 0},
	{0x1A25, 0x6B, 0x7F, 0},
	{0x1A26, 0x10, 0x56, 0},
	{0x1A27, 0x2D, 0x2F, 0},
	{0x1A28, 0x1, 0x1, 0},
	{0x1A29, 0xFA, 0xFF, 0},
	{0x1A2A, 0x32, 0x3F, 0},
	{0x1A2C, 0xC, 0xC, 0},
	{0x1A2D, 0x7F, 0xFF, 0},
	{0x1A2E, 0xC0, 0xFF, 0},
	{0x1A2F, 0x6B, 0x7F, 0},
	{0x1A37, 0xFF, 0xFF, 0},
	{0x1A39, 0xE5, 0xFF, 0},
	{0x1A3A, 0x5F, 0xFF, 0},
	{0x1A3B, 0x5F, 0xFF, 0},
	{0x1A3C, 0x5F, 0xFF, 0},
	{0x1A3D, 0xF0, 0xF0, 0},
	{0x1A46, 0x80, 0x80, 0},
	{0x1A4E, 0x0, 0x80, 0},
	{0x1A56, 0x0, 0x80, 0},
	{0x1A5E, 0x0, 0x80, 0},
	{0x1A61, 0x0, 0x78, 0},
	{0x1A89, 0xC, 0x2C, 0},
	{0x1A8B, 0xF8, 0xF8, 0},
	{0x1A8C, 0x32, 0x3F, 0},
	{0x1A8E, 0xC, 0xC, 0},
	{0x1A8F, 0xEF, 0xFF, 0},
	{0x1A90, 0x10, 0xFF, 0},
	{0x1A91, 0x4, 0xF, 0},
	{0x1A92, 0x10, 0x56, 0},
	{0x1A93, 0x2D, 0x2F, 0},
	{0x1A94, 0x1, 0x1, 0},
	{0x1A95, 0xFA, 0xFF, 0},
	{0x1A96, 0x32, 0x3F, 0},
	{0x1A98, 0xC, 0xC, 0},
	{0x1A99, 0x7F, 0xFF, 0},
	{0x1A9A, 0xC0, 0xFF, 0},
	{0x1A9B, 0x6B, 0x7F, 0},
	{0x1A9C, 0x10, 0x56, 0},
	{0x1A9D, 0x2D, 0x2F, 0},
	{0x1A9E, 0xC1, 0xC1, 0},
	{0x1A9F, 0xFA, 0xFF, 0},
	{0x1AA0, 0x32, 0x3F, 0},
	{0x1AA2, 0xC, 0xC, 0},
	{0x1AA3, 0x7F, 0xFF, 0},
	{0x1AA4, 0xC0, 0xFF, 0},
	{0x1AA5, 0x6B, 0x7F, 0},
	{0x1AA6, 0x10, 0x56, 0},
	{0x1AA7, 0x2D, 0x2F, 0},
	{0x1AA8, 0x1, 0x1, 0},
	{0x1AA9, 0xFA, 0xFF, 0},
	{0x1AAA, 0x32, 0x3F, 0},
	{0x1AAC, 0xC, 0xC, 0},
	{0x1AAD, 0x7F, 0xFF, 0},
	{0x1AAE, 0xC0, 0xFF, 0},
	{0x1AAF, 0x6B, 0x7F, 0},
	{0x1AB7, 0xFF, 0xFF, 0},
	{0x1AB9, 0x45, 0xFF, 0},
	{0x1ABA, 0x5F, 0xFF, 0},
	{0x1ABB, 0x5F, 0xFF, 0},
	{0x1ABC, 0x5F, 0xFF, 0},
	{0x1ABD, 0xF0, 0xF0, 0},
	{0x1AC5, 0x66, 0xFF, 0},
	{0x1AC6, 0x0, 0x80, 0},
	{0x1ACE, 0x0, 0x80, 0},
	{0x1AD6, 0x0, 0x80, 0},
	{0x1ADE, 0x0, 0x80, 0},
	{0x1AE1, 0x8, 0x78, 0},
	{0x1B0D, 0xF, 0xF, 0},
	{0x1B0E, 0x1, 0x1, 0},
	{0x1B10, 0xFF, 0xFF, 0},
	{0x1B13, 0xFF, 0xFF, 0},
	{0x1B16, 0xFF, 0xFF, 0},
	{0x1B2A, 0x8, 0x8, 0},
	{0x1B88, 0x10, 0x10, 0},
	{0x1B89, 0x0, 0x80, 0},
	{0x1B96, 0x10, 0x10, 0},
	{0x1B97, 0x0, 0x80, 0},
	{0x1BA4, 0x10, 0x10, 0},
	{0x1BA5, 0x0, 0x80, 0},
	{0x1BAA, 0x40, 0x40, 0},
	{0x1BB2, 0x10, 0x10, 0},
	{0x1BB3, 0x0, 0x80, 0},
	{0x1BC0, 0x10, 0x10, 0},
	{0x1BC1, 0x0, 0x80, 0},
	{0x1BCE, 0x10, 0x10, 0},
	{0x1BCF, 0x0, 0x80, 0},
	{0x1C08, 0x10, 0x10, 0},
	{0x1C09, 0x0, 0x80, 0},
	{0x1C16, 0x10, 0x10, 0},
	{0x1C17, 0x0, 0x80, 0},
	{0x1C24, 0x10, 0x10, 0},
	{0x1C25, 0x0, 0x80, 0},
	{0x1C32, 0x10, 0x10, 0},
	{0x1C33, 0x0, 0x80, 0},
	{0x1C40, 0x10, 0x10, 0},
	{0x1C41, 0x0, 0x80, 0},
	{0x1C4E, 0x10, 0x10, 0},
	{0x1C4F, 0x0, 0x80, 0},
	{0x1C88, 0x10, 0x10, 0},
	{0x1C89, 0x0, 0x80, 0},
	{0x1C96, 0x10, 0x10, 0},
	{0x1C97, 0x0, 0x80, 0},
	{0x1CA4, 0x10, 0x10, 0},
	{0x1CA5, 0x0, 0x80, 0},
	{0x1CB2, 0x10, 0x10, 0},
	{0x1CB3, 0x0, 0x80, 0},
	{0x1CC1, 0x10, 0x10, 0},
	{0x1CC2, 0x0, 0x80, 0},
	{0x1CCF, 0x10, 0x10, 0},
	{0x1CD0, 0x0, 0x80, 0},
	{0x1D08, 0x30, 0x30, 0},
	{0x1D09, 0x0, 0x80, 0},
	{0x1D16, 0x30, 0x30, 0},
	{0x1D17, 0x0, 0x80, 0},
	{0x1D24, 0x30, 0x30, 0},
	{0x1D25, 0x0, 0x80, 0},
	{0x1D32, 0x30, 0x30, 0},
	{0x1D33, 0x0, 0x80, 0},
	{0x1D41, 0x30, 0x30, 0},
	{0x1D42, 0x0, 0x80, 0},
	{0x1D88, 0x10, 0x10, 0},
	{0x1D89, 0x0, 0x80, 0},
	{0x1E22, 0x1, 0x1, 0},
	{0x1E3A, 0x1, 0x1, 0},
	{0x1E3E, 0x1, 0x1, 0},
	{0x1E97, 0x2, 0x3, 0},
	{0x1E9B, 0x2, 0x3, 0},
	{0x1F0B, 0x8, 0xC, 0},
	{0x1F0F, 0x8, 0xC, 0},
	{0x1F8B, 0x8, 0xC, 0},
	{0x1F8F, 0x20, 0x30, 0},
};

static struct pmic_setting diff_setting[] = {
	{0x1989, 0x12, 0x56, 0},
	{0x1991, 0x80, 0xFF, 0},
	{0x1992, 0xA, 0x7F, 0},
	{0x1993, 0x12, 0x56, 0},
	{0x1995, 0x1, 0x61, 0},
	{0x199B, 0x80, 0xFF, 0},
	{0x199C, 0xA, 0x7F, 0},
	{0x19A0, 0xC, 0xF, 0},
	{0x19A1, 0x1F, 0xFF, 0},
	{0x19A2, 0x1F, 0xFF, 0},
	{0x1A09, 0x2D, 0x2F, 0},
	{0x1A12, 0x12, 0x56, 0},
	{0x1A1A, 0x80, 0xFF, 0},
	{0x1A1B, 0xA, 0x7F, 0},
	{0x1A1C, 0x12, 0x56, 0},
	{0x1A1E, 0x1, 0xC1, 0},
	{0x1A24, 0x80, 0xFF, 0},
	{0x1A25, 0xA, 0x7F, 0},
	{0x1A26, 0x12, 0x56, 0},
	{0x1A2E, 0x80, 0xFF, 0},
	{0x1A2F, 0xA, 0x7F, 0},
	{0x1A37, 0xF1, 0xFF, 0},
	{0x1A3A, 0x1F, 0xFF, 0},
	{0x1A3B, 0x1F, 0xFF, 0},
	{0x1A3C, 0x1F, 0xFF, 0},
	{0x1A89, 0x2C, 0x2C, 0},
	{0x1A92, 0x12, 0x56, 0},
	{0x1A9A, 0x80, 0xFF, 0},
	{0x1A9B, 0xA, 0x7F, 0},
	{0x1A9C, 0x12, 0x56, 0},
	{0x1A9E, 0x1, 0xC1, 0},
	{0x1AA4, 0x80, 0xFF, 0},
	{0x1AA5, 0xA, 0x7F, 0},
	{0x1AA6, 0x12, 0x56, 0},
	{0x1AAE, 0x80, 0xFF, 0},
	{0x1AAF, 0xA, 0x7F, 0},
	{0x1AB7, 0xF1, 0xFF, 0},
	{0x1AB9, 0xC5, 0xFF, 0},
	{0x1ABA, 0x1F, 0xFF, 0},
	{0x1ABB, 0x1F, 0xFF, 0},
	{0x1ABC, 0x1F, 0xFF, 0},
};

static struct pmic_setting diff_CW_setting[] = {
	{0xA21, 0x9, 0xFF, 0},
	{0xA22, 0xFF, 0xFF, 0},
	{0x1687, 0x5C, 0xFF, 0},
	{0x168A, 0xF, 0x7F, 0},
	{0x168B, 0xF, 0x7F, 0},
	{0x1A88, 0x10, 0x10, 0},
	{0x1A89, 0xD, 0x2F, 0},
	{0x1A90, 0x0, 0xFF, 0},
	{0x1A91, 0x0, 0xF, 0},
	{0x1AB7, 0xFE, 0xFF, 0},
	{0x1AB9, 0xCD, 0xFF, 0},
	{0x1AC5, 0x44, 0xFF, 0},
};

static void second_pmic_cmp_register(void)
{
#if INIT_SETTING_VERIFIED
	int i;
	U8 val = 0;

	for (i = 0; i < ARRAY_SIZE(init_setting); i++) {
		second_pmic_read_interface(init_setting[i].addr, &val,
					   init_setting[i].mask,
					   init_setting[i].shift);
		if (val != init_setting[i].val) {
			pal_log_info("second_pmic_init cmp: 0x%x\tval=0x%x\trval=0x%x\t0x%x\t%d\n"
				     , init_setting[i].addr, init_setting[i].val, val
				     , init_setting[i].mask, init_setting[i].shift);
		}
	}
#endif
}

void second_pmic_init_setting(void)
{
	unsigned int ret = 0;
	int i;

	pal_log_info("%s start\n", __func__);
#if INIT_SETTING_VERIFIED
	/* TOP_TMA_KEY */
	second_upmu_set_reg_value16(MT6373_PMIC_TMA_KEY_L_ADDR, 0x9C8C);
	/* HK_TOP_WKEY */
	second_upmu_set_reg_value16(MT6373_PMIC_HK_AUXADC_KEY_L_ADDR, 0x6373);
	/* BUCK_TOP_KEY_PROT */
	second_upmu_set_reg_value16(MT6373_PMIC_BUCK_TOP_WRITE_KEY_LO_ADDR, 0x5543);
	/* PLT_KEY */
	second_upmu_set_reg_value16(MT6373_PMIC_PLT_WPK_KEY_ADDR, 0x9C8C);
	/* CPS_WKEY */
	second_upmu_set_reg_value16(MT6373_PMIC_RG_CPS_W_KEY_ADDR, 0x4729);

	/* For VIO18 switch to DIG18 feature */
	second_pmic_config_interface(MT6373_PMIC_RG_VDIG18_VREF_SEL_ADDR, 0x1,
				     MT6373_PMIC_RG_VDIG18_VREF_SEL_MASK,
				     MT6373_PMIC_RG_VDIG18_VREF_SEL_SHIFT);

	for (i = 0; i < ARRAY_SIZE(init_setting); i++) {
		ret = second_pmic_config_interface(init_setting[i].addr, init_setting[i].val,
						   init_setting[i].mask, init_setting[i].shift);
	}
	if (second_upmu_get_reg_value(MT6373_HWCID0) == 0x10) {
		for (i = 0; i < ARRAY_SIZE(diff_setting); i++) {
			ret = second_pmic_config_interface(diff_setting[i].addr, diff_setting[i].val,
							   diff_setting[i].mask, diff_setting[i].shift);
		}
	} else if (is_second_pmic_pp_swap()) {
		for (i = 0; i < ARRAY_SIZE(diff_CW_setting); i++) {
			ret = second_pmic_config_interface(diff_CW_setting[i].addr, diff_CW_setting[i].val,
							   diff_CW_setting[i].mask, diff_CW_setting[i].shift);
		}
	}
#if EFUSE_SW_LOAD
	second_pmic_efuse_sw_load();
#else
	pal_log_info("[SECOND_PMIC] No EFUSE SW Load\n");
#endif

	/* TOP_TMA_KEY */
	second_upmu_set_reg_value16(MT6373_PMIC_TMA_KEY_L_ADDR, 0x0);
	/* HK_TOP_WKEY */
	second_upmu_set_reg_value16(MT6373_PMIC_HK_AUXADC_KEY_L_ADDR, 0x0);
	/* BUCK_TOP_KEY_PROT */
	second_upmu_set_reg_value16(MT6373_PMIC_BUCK_TOP_WRITE_KEY_LO_ADDR, 0x0);
	/* PLT_KEY */
	second_upmu_set_reg_value16(MT6373_PMIC_PLT_WPK_KEY_ADDR, 0x0);
	/* CPS_WKEY */
	second_upmu_set_reg_value16(MT6373_PMIC_RG_CPS_W_KEY_ADDR, 0x0);

	if (is_second_pmic_pp_swap())
		pal_log_info("[SECOND_PMIC] mt6373CW_init_setting end. v211113\n");
	else
		pal_log_info("[SECOND_PMIC] mt6373_init_setting end. v211113\n");
#endif
}
